---
'@accounter/server': patch
---

* **New Database Schema for Issued Documents**: I've introduced a new `documents_issued` table in the database. This table stores crucial metadata for documents generated by our system (e.g., via Green Invoice), including their external ID, current status, and any linked documents. A new `document_status` enum has also been added to track the lifecycle of these documents.
* **Enhanced Green Invoice Integration**: The Green Invoice client and GraphQL API have been significantly extended. New capabilities allow us to preview, issue, and close documents directly through the Green Invoice API via new GraphQL mutations. This provides more comprehensive control over self-issued financial documents.
* **Improved Document Synchronization Logic**: The `fetchIncomeDocuments` mutation has been refactored to not only ingest new documents from Green Invoice but also to intelligently identify and update the status and linked documents of existing self-issued records in our database. This ensures better data consistency with the external system.
* **GraphQL API Expansion for Document Management**: I've exposed new GraphQL types (`IssuedDocumentInfo`) and mutations (`closeDocument`, `previewGreenInvoiceDocument`, `issueGreenInvoiceDocument`) to provide a richer API for managing self-issued documents and their associated information, including their status and links to other documents.
